<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css">
	<style type="text/css">
		html, body{
			padding: 0px;
			margin: 0px;
			height: 100%;
			width: 100%;
		}
		#map{
			min-height: 90%;
			height: 100%;
			width: auto;
		}
	</style>
</head>
<body>
	<div id="map">

	</div>
  <script src="//cdnjs.cloudflare.com/ajax/libs/zepto/1.0/zepto.min.js"></script>
	<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
	<script>
		$(function(){
			"use strict";

			var map = L.map('map').setView([39.9500, -75.1700], 13);

			L.tileLayer('http://{s}.tile.cloudmade.com/f7210b3965cb4109a0ae47a7d668d1e5/997/256/{z}/{x}/{y}.png', {
    		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,'+
    					'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© '+
    					'<a href="http://cloudmade.com">CloudMade</a>',
    			maxZoom: 18
			}).addTo(map);

			var showPosition = function(position){
				var c = position.coords;
				var coords = [c.latitude, c.longitude];
				map.setView(coords, 15);

        var f = $.getJSON('/locations', {lat : coords[0], lon: coords[1]});
        console.log(f);
				new L.marker(coords).addTo(map);
			};

			if (navigator.geolocation)
			{
			    navigator.geolocation.getCurrentPosition(showPosition);
			}

		});
	</script>
</body>
</html>